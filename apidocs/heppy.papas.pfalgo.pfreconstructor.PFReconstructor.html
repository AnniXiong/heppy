<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>heppy.papas.pfalgo.pfreconstructor.PFReconstructor : API documentation</title>

    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <link type="text/css" href="bootstrap.min.css" rel="stylesheet" />
    <link type="text/css" href="apidocs.css" rel="stylesheet" />
  </head>
  <body>

    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="navbar-brand">
            heppy API Documentation
          </a>
        </div>
      </div>
    </nav>

    <div id="showPrivate">
      <button onclick="togglePrivate()" class="btn btn-link">Toggle Private API</button>
    </div>

    <div class="container">

      <div class="page-header">
        <h1 class="class"><code>heppy.papas.pfalgo.pfreconstructor.PFReconstructor(<span title="object">object</span>)</code> <small>class documentation</small></h1>

        <span id="partOf">
          Part of <code><a href="heppy.html" data-type="Package" class="code">heppy</a>.<a href="heppy.papas.html" data-type="Package" class="code">papas</a>.<a href="heppy.papas.pfalgo.html" data-type="Package" class="code">pfalgo</a>.<a href="heppy.papas.pfalgo.pfreconstructor.html" data-type="Module" class="code">pfreconstructor</a></code>
          
          <a href="classIndex.html#heppy.papas.pfalgo.pfreconstructor.PFReconstructor">(View In Hierarchy)</a>
        </span>
      </div>

      <div class="extrasDocstring">
        
      </div>

      <div class="moduleDocstring">
        <pre>The reconstructor takes an event containing blocks of elements
and attempts to reconstruct particles
The following strategy is used (to be checked with Colin)
single elements:
     track -&gt; charged hadron
     hcal  -&gt; neutral hadron
     ecal  -&gt; photon
connected elements:
      has more than one hcal
        -&gt; each hcal is treated using rules below
      has an hcal with one or more connected tracks
        -&gt; add up all connected track energies, turn each track into a charged hadron
        -&gt; add up all ecal energies connected to the above tracks
        -&gt; if excess = hcal energy + ecal energies - track energies &gt; 0
               and excess &lt; ecal energies
                   then turn the excess into an photon
        -&gt; if excess &gt; 0 and excess &gt; ecal energies
                  make a neutral hadron with excess- ecal energies
                  make photon with ecal energies
      has hcal but no track (nb by design there will be no attached ecals because hcal ecal links have been removed
            so this will equate to single hcal:- that two hcals should not occur as a single block
            because if they are close enough to be linked then they should already have been merged)
        -&gt; make a neutral hadron 
      
      has track(s) 
        -&gt; each track is turned into a charged hadron
      has track(s) and  ecal(s)
        -&gt; the tracks are turned into charged hadrons, the ecals are marked as locked but energy is not checked 
        and no photons are made
        TODO handle case where there is more energy in ecals than in the track and make some photons
      has only ecals 
        -&gt; this should not occur because ecals that are close enough to be linked should already have been merged

     
 If history_nodes are provided then the particles are linked into the exisiting history
 
 Contains:
    blocks: the dictionary of blocks to be reconstructed { blockid; block }
    unused: list of unused elements
    particles: list of constructed particles
    history_nodes: optional, desribes links between elements, blocks, particles
 Example usage:
 
      reconstructed = PFReconstructor(event)
      event.reconstructed_particles= sorted( reconstructed.particles,
                    key = lambda ptc: ptc.e(), reverse=True)
      event.history_nodes=reconstructed.history_nodes</pre>
      </div>

      <div id="splitTables">
        <table class="children sortable" id="id351">
  
  <tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#__init__" data-type="Method" class="code">__init__</a></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#reconstruct" data-type="Method" class="code">reconstruct</a></td>
    <td><span>arguments event: should contain blocks and optionally history_nodes</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#simplify_blocks" data-type="Method" class="code">simplify_blocks</a></td>
    <td><span>Block: a block which contains list of element ids and set of edges that 
connect them history_nodes: optional dictionary of Nodes with element 
identifiers in each node</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#reconstruct_block" data-type="Method" class="code">reconstruct_block</a></td>
    <td><span>see class description for summary of reconstruction approach</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#insert_particle" data-type="Method" class="code">insert_particle</a></td>
    <td><span>The new particle will be inserted into the history_nodes (if present). A
new node for the particle will be created if needed. It will have as its 
parents the block and all the elements of the block.</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#neutral_hadron_energy_resolution" data-type="Method" class="code">neutral_hadron_energy_resolution</a></td>
    <td><span class="undocumented">No summary</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#nsigma_hcal" data-type="Method" class="code">nsigma_hcal</a></td>
    <td><span>Currently returns 2. CMS is doing the following (implementation in 
commented code) 
http://cmslxr.fnal.gov/source/RecoParticleFlow/PFProducer/src/PFAlgo.cc#3365</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#reconstruct_hcal" data-type="Method" class="code">reconstruct_hcal</a></td>
    <td><span>block: element ids and edges hcalid: id of the hcal being processed 
her</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#reconstruct_cluster" data-type="Method" class="code">reconstruct_cluster</a></td>
    <td><span>construct a photon if it is an ecal construct a neutral hadron if it is 
an hcal</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#reconstruct_track" data-type="Method" class="code">reconstruct_track</a></td>
    <td><span>construct a charged hadron from the track</span></td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#__str__" data-type="Method" class="code">__str__</a></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="method private">
    
    <td>Method</td>
    <td><a href="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.html#_sorted_block_keys" data-type="Method" class="code">_sorted_block_keys</a></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
        

          
      </div>

      <div id="childList">

        <div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.__init__">
    
  </a>
  <a name="__init__">
    
  </a>
  <div class="functionHeader">
    
    def
    __init__(self, detector, logger):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div class="undocumented">Undocumented</div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.reconstruct">
    
  </a>
  <a name="reconstruct">
    
  </a>
  <div class="functionHeader">
    
    def
    reconstruct(self, event, blocksname, historyname):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>arguments event: should contain blocks and optionally history_nodes</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod private">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor._sorted_block_keys">
    
  </a>
  <a name="_sorted_block_keys">
    
  </a>
  <div class="functionHeader">
    
    def
    _sorted_block_keys(self):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div class="undocumented">Undocumented</div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.simplify_blocks">
    
  </a>
  <a name="simplify_blocks">
    
  </a>
  <div class="functionHeader">
    
    def
    simplify_blocks(self, block, history_nodes=None):
    
  </div>
  <div class="docstring functionBody">
    
    
    <pre>Block: a block which contains list of element ids and set of edges that connect them
    history_nodes: optional dictionary of Nodes with element identifiers in each node

returns None or a dictionary of new split blocks
    
The goal is to remove, if needed, some links from the block so that each track links to 
at most one hcal within a block. In some cases this may separate a block into smaller
blocks (splitblocks). The BlockSplitter is used to return the new smaller blocks.
 If history_nodes are provided then the history will be updated. Split blocks will 
 have the tracks and cluster elements as parents, and also the original block as a parent</pre>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.reconstruct_block">
    
  </a>
  <a name="reconstruct_block">
    
  </a>
  <div class="functionHeader">
    
    def
    reconstruct_block(self, block):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>see class description for summary of reconstruction approach</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.insert_particle">
    
  </a>
  <a name="insert_particle">
    
  </a>
  <div class="functionHeader">
    
    def
    insert_particle(self, block, newparticle):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>The new particle will be inserted into the history_nodes (if present). A
new node for the particle will be created if needed. It will have as its 
parents the block and all the elements of the block.</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.neutral_hadron_energy_resolution">
    
  </a>
  <a name="neutral_hadron_energy_resolution">
    
  </a>
  <div class="functionHeader">
    
    def
    neutral_hadron_energy_resolution(self, energy, eta):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>Currently returns the hcal resolution of the detector in use. That's a 
generic solution, but CMS is doing the following (implementation in 
commented code) 
http://cmslxr.fnal.gov/source/RecoParticleFlow/PFProducer/src/PFAlgo.cc#3350</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.nsigma_hcal">
    
  </a>
  <a name="nsigma_hcal">
    
  </a>
  <div class="functionHeader">
    
    def
    nsigma_hcal(self, cluster):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>Currently returns 2. CMS is doing the following (implementation in 
commented code) 
http://cmslxr.fnal.gov/source/RecoParticleFlow/PFProducer/src/PFAlgo.cc#3365</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.reconstruct_hcal">
    
  </a>
  <a name="reconstruct_hcal">
    
  </a>
  <div class="functionHeader">
    
    def
    reconstruct_hcal(self, block, hcalid):
    
  </div>
  <div class="docstring functionBody">
    
    
    <pre>block: element ids and edges 
hcalid: id of the hcal being processed her

has hcal and has a track
     -&gt; add up all connected tracks, turn each track into a charged hadron
     -&gt; add up all ecal energies
     -&gt; if track energies is greater than hcal energy then turn the missing energies into an ecal (photon)
           NB this links the photon to the hcal rather than the ecals
     -&gt; if track energies are less than hcal then make a neutral hadron with rest of hcal energy and turn all ecals into photons
   has hcal but no track (nb by design there will be no attached ecals because hcal ecal links have been removed)
     -&gt; make a neutral hadron
   has hcals
     -&gt; each hcal is treated using rules above</pre>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.reconstruct_cluster">
    
  </a>
  <a name="reconstruct_cluster">
    
  </a>
  <div class="functionHeader">
    
    def
    reconstruct_cluster(self, cluster, layer, energy=None, vertex=None):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>construct a photon if it is an ecal construct a neutral hadron if it is 
an hcal</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.reconstruct_track">
    
  </a>
  <a name="reconstruct_track">
    
  </a>
  <div class="functionHeader">
    
    def
    reconstruct_track(self, track, clusters=None):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>construct a charged hadron from the track</p><table class="fieldTable"></table></div>
  </div>
</div><div class="basemethod">
  
  <a name="heppy.papas.pfalgo.pfreconstructor.PFReconstructor.__str__">
    
  </a>
  <a name="__str__">
    
  </a>
  <div class="functionHeader">
    
    def
    __str__(self):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div class="undocumented">Undocumented</div>
  </div>
</div>

      </div>
      <address>
        <a href="index.html">API Documentation</a> for heppy, generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a> at 2016-11-02 16:20:55.
      </address>

    </div>

    <script type="text/javascript" src="pydoctor.js"></script>

  </body>
</html>